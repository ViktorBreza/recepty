# üöÄ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—é –∞–≤—Ç–æ–¥–µ–ø–ª–æ—é

## –ö—Ä–æ–∫ 1: –ù–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ (–∑–∞—Ä–∞–∑)

```bash
# –í—ñ–¥–ø—Ä–∞–≤ –≤—Å—ñ –∑–º—ñ–Ω–∏
git add .
git commit -m "Setup dev/test environments"
git push origin main

# –°—Ç–≤–æ—Ä–∏ test –≥—ñ–ª–∫—É
git checkout -b test
git push -u origin test
git checkout main
```

## –ö—Ä–æ–∫ 2: GitHub Secrets

–ô–¥–∏ –≤ GitHub ‚Üí Settings ‚Üí Secrets and Variables ‚Üí Actions —ñ –¥–æ–¥–∞–π:

```
PI_HOST = kitkuhar.com (–∞–±–æ IP —Ç–≤–æ—î—ó Pi)
PI_USER = pi (–∞–±–æ —Ç–≤—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞ Pi) 
PI_SSH_KEY = [SSH –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á - –¥–∏–≤–∏—Å—å –Ω–∏–∂—á–µ —è–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏]
```

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è SSH –∫–ª—é—á–∞:

–ù–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ:
```bash
ssh-keygen -t ed25519 -C "github-actions"
# –ù–∞—Ç–∏—Å–Ω–∏ Enter –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ ~/.ssh/id_ed25519
# –ù–µ —Å—Ç–∞–≤–∏—Ç–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó

# –°–∫–æ–ø—ñ—é–π –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á
cat ~/.ssh/id_ed25519.pub
```

–ù–∞ Raspberry Pi:
```bash
# –î–æ–¥–∞–π –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –≤ authorized_keys
echo "ssh-ed25519 AAAA... github-actions" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

–ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á (`~/.ssh/id_ed25519`) - —Å–∫–æ–ø—ñ—é–π –≤–µ—Å—å –≤–º—ñ—Å—Ç –≤ GitHub Secret `PI_SSH_KEY`

## –ö—Ä–æ–∫ 3: –ù–∞ Raspberry Pi

**–í–ê–ñ–õ–ò–í–û: –ù–µ –∑—É–ø–∏–Ω—è–π –ø–æ—Ç–æ—á–Ω–∏–π —Å–∞–π—Ç!**

```bash
# –°—Ç–≤–æ—Ä–∏ –æ–∫—Ä–µ–º—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –¥–ª—è —Å–µ—Ä–µ–¥–æ–≤–∏—â
sudo mkdir -p /home/pi/kitkuhar-deployments/{test,prod}
sudo chown -R pi:pi /home/pi/kitkuhar-deployments

# –ö–ª–æ–Ω—É–π —Ä–µ–ø–æ –¥–ª—è test —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
cd /home/pi/kitkuhar-deployments/test
git clone https://github.com/[—Ç–≤—ñ–π-username]/kitkuhar.git .
git checkout test

# –ö–ª–æ–Ω—É–π —Ä–µ–ø–æ –¥–ª—è prod —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞  
cd /home/pi/kitkuhar-deployments/prod
git clone https://github.com/[—Ç–≤—ñ–π-username]/kitkuhar.git .
git checkout main

# –ö–æ–ø—ñ—é–π .env —Ñ–∞–π–ª–∏
cd /home/pi/kitkuhar-deployments/test
cp .env.test .env

cd /home/pi/kitkuhar-deployments/prod  
cp .env.production .env
```

## –ö—Ä–æ–∫ 4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑ –∑—É–ø–∏–Ω–∫–∏ prod

```bash
# –°–ø–æ—á–∞—Ç–∫—É —Ç–µ—Å—Ç—É—î–º–æ test —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –Ω–∞ —ñ–Ω—à–∏—Ö –ø–æ—Ä—Ç–∞—Ö
cd /home/pi/kitkuhar-deployments/test
docker-compose -f docker-compose.test.yml up -d

# –ü–µ—Ä–µ–≤—ñ—Ä —á–∏ –ø—Ä–∞—Ü—é—î –Ω–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –ø–æ—Ä—Ç–∞—Ö
curl http://localhost:3002  # frontend test
curl http://localhost:8002  # backend test
```

## –ö—Ä–æ–∫ 5: –ö–æ–ª–∏ –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø–µ—Ä–µ—Ö–æ–¥—É

–ö–æ–ª–∏ –≤—Å–µ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ —ñ –ø—Ä–∞—Ü—é—î:

```bash
# –ó—É–ø–∏–Ω–∏ —Å—Ç–∞—Ä–∏–π —Å–∞–π—Ç
cd /home/pi/[—Ç–≤–æ—è-–ø–æ—Ç–æ—á–Ω–∞-–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è]  
docker-compose down

# –ó–∞–ø—É—Å—Ç–∏ –Ω–æ–≤–∏–π prod —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π
cd /home/pi/kitkuhar-deployments/prod
docker-compose up -d

# –ü–µ—Ä–µ–≤—ñ—Ä
curl https://kitkuhar.com
```

## –ö—Ä–æ–∫ 6: Workflow —Ä–æ–∑—Ä–æ–±–∫–∏

–¢–µ–ø–µ—Ä –¥–ª—è –≤–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω:

1. **–ù–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ —Ä–æ–∑—Ä–æ–±–ª—è—î–º–æ:**
```bash
git checkout test
# –†–æ–±–∏–º–æ –∑–º—ñ–Ω–∏
git add .
git commit -m "feat: –Ω–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è"
git push origin test  # ‚Üê –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π –Ω–∞ test!
```

2. **–¢–µ—Å—Ç—É—î–º–æ –Ω–∞ https://test.kitkuhar.com**

3. **–Ø–∫—â–æ –≤—Å–µ OK - –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ –≤ prod:**
```bash
git checkout main
git merge test
git push origin main  # ‚Üê –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π –Ω–∞ prod!
```

## –ü–µ—Ä–µ–≤–∞–≥–∏ —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:

‚úÖ –°–∞–π—Ç –Ω–µ –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –¥–µ–ø–ª–æ—ó  
‚úÖ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–º  
‚úÖ Rollback —á–µ—Ä–µ–∑ GitHub  
‚úÖ –†–æ–∑—Ä–æ–±–∫–∞ –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ  

## Troubleshooting

### –Ø–∫—â–æ —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫:
```bash
# –®–≤–∏–¥–∫–∏–π rollback –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó
cd /home/pi/kitkuhar-deployments/prod
git reset --hard HEAD~1
docker-compose up --build -d
```

### –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤:
```bash
cd /home/pi/kitkuhar-deployments/prod
docker-compose logs -f
```

---

# ‚ö†Ô∏è –ß–ê–°–¢–´–ï –ü–†–û–ë–õ–ï–ú–´ –î–ï–ü–õ–û–Ø –ò –Ø–ö –á–• –£–ù–ò–ö–ê–¢–ò

## üî• –ü—Ä–æ–±–ª–µ–º–∞ #1: `/api/docs` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx proxy.

‚ùå **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û**:
```nginx
location /api/ {
    proxy_pass http://backend/api/;  # –î–í–û–ô–ù–û–ô /api/ !!!
}
```

‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–û**:
```nginx
location /api/ {
    proxy_pass http://backend/;  # –ë–ï–ó /api/ –Ω–∞ –∫–æ–Ω—Ü–µ
}
```

**–ü–æ—á–µ–º—É**: FastAPI —Ä–æ—É—Ç–µ—Ä—ã —É–∂–µ –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `/api/`, nginx –¥–æ–±–∞–≤–ª—è—Ç—å –ù–ï –Ω–∞–¥–æ!

## üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

–¢–µ–ø–µ—Ä—å –≤ workflow –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
./scripts/test-nginx-config.sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoints –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è  
```bash
./scripts/verify-deployment.sh
```

## üéØ –ö–∞–∫ –Ω–∞–≤—Å–µ–≥–¥–∞ –∏–∑–±–µ–∂–∞—Ç—å —ç—Ç–∏—Ö –ø—Ä–æ–±–ª–µ–º

### 1. –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π nginx –∫–æ–Ω—Ñ–∏–≥:
```bash
# –ò—â–∏ –¥–≤–æ–π–Ω—ã–µ /api/ –ø—Ä–µ—Ñ–∏–∫—Å—ã
grep "proxy_pass.*backend/api/" nginx/nginx.nextjs.conf
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç - —ç—Ç–æ –û–®–ò–ë–ö–ê!
```

### 2. –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π endpoints –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
```bash
curl -f https://kitkuhar.com/api/docs
curl -f https://kitkuhar.com/api/health  
```

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:
```
URL: https://kitkuhar.com/api/docs
     ‚Üì
Nginx: location /api/ { proxy_pass http://backend/; }
     ‚Üì  
Backend: FastAPI(docs_url="/api/docs") + —Ä–æ—É—Ç–µ—Ä—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º /api/
     ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç: backend:8000/api/docs ‚úÖ
```

## üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ 404

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è `/api/docs` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**:
   ```bash
   curl -f https://kitkuhar.com/api/health
   # –ï—Å–ª–∏ 404 - –ø—Ä–æ–±–ª–µ–º–∞ –≤ nginx routing
   # –ï—Å–ª–∏ 405 - endpoint –µ—Å—Ç—å, –Ω–æ –º–µ—Ç–æ–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—ç—Ç–æ OK)
   ```

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
   ```bash
   # –í nginx/nginx.nextjs.conf –Ω–∞–π–¥–∏ –∏ –∏—Å–ø—Ä–∞–≤—å:
   proxy_pass http://backend/api/;  # ‚Üê —É–±–µ—Ä–∏ /api/
   # –Ω–∞:  
   proxy_pass http://backend/;
   ```

3. **–ö–æ–º–º–∏—Ç –∏ –ø—É—à** - –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π –∏—Å–ø—Ä–∞–≤–∏—Ç –ø—Ä–æ–±–ª–µ–º—É.

## üìù –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–ø–ª–æ–µ–º

- [ ] Nginx syntax OK: `nginx -t` 
- [ ] –ù–µ—Ç –¥–≤–æ–π–Ω—ã—Ö `/api/` –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –≤ proxy_pass
- [ ] FastAPI docs_url="/api/docs"
- [ ] –°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤—Å–µ endpoints –æ—Ç–≤–µ—á–∞—é—Ç

**–ó–ê–ü–û–ú–ù–ò**: –≠—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—ç–∫–æ–Ω–æ–º—è—Ç –∫—É—á—É –≤—Ä–µ–º–µ–Ω–∏!

---

# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: WEBHOOK –ù–ï –û–ë–ù–û–í–õ–Ø–ï–¢ –§–ê–ô–õ–´

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

**–°–∏–º–ø—Ç–æ–º—ã**:
- ‚úÖ Webhook –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (200 OK)
- ‚ùå Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è  
- ‚ùå Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –ø–µ—Ä–µ–±—É–¥–æ–≤—ã–≤–∞—é—Ç—Å—è
- ‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–¢–µ—Å—Ç**: `curl https://kitkuhar.com/health` –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é v1.0.1, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π deployment script

```bash
# –ù–∞ Raspberry Pi —Å–æ–∑–¥–∞—Ç—å /home/pi/kitkuhar/deploy.sh
chmod +x deploy.sh
```

### 2. Webhook —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å:

```bash
cd /home/pi/kitkuhar
./deploy.sh
```

### 3. deploy.sh –¥–æ–ª–∂–µ–Ω:
- –ü–æ–ª—É—á–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ Git
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã  
- –û—á–∏—â–∞—Ç—å Docker –∫–µ—à
- –ü–µ—Ä–µ–±—É–¥–æ–≤—ã–≤–∞—Ç—å —Å --no-cache
- –ó–∞–ø—É—Å–∫–∞—Ç—å –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ webhook —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é:
curl https://kitkuhar.com/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: "–ö—ñ—Ç –ö—É—Ö–∞—Ä is healthy! v1.0.1 - nginx updated"

# –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:
curl https://kitkuhar.com/api/docs
# –û–∂–∏–¥–∞–µ—Ç—Å—è: FastAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Ñ–∏–∫—Å

–ü–æ–∫–∞ webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å `./deploy.sh` –≤—Ä—É—á–Ω—É—é
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å